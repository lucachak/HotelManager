{% extends 'base.html' %}

{% block title %}Dashboard | Lucachak Systems{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto space-y-8 animate-fade-in">

    <div class="flex flex-col md:flex-row justify-between items-start md:items-end gap-4">
        <div>
            <h2 class="text-3xl font-bold text-base-content">Visão Geral</h2>
            <p class="text-base-content/60 mt-1">
                Resumo operacional de hoje, {{ today|date:"d \d\e F" }}.
            </p>
        </div>

        <div class="flex items-center gap-3 w-full md:w-auto">
            <form action="{% url 'logout_to_login' %}" method="post" class="inline" hx-boost="false">
                {% csrf_token %}
                <button type="submit" class="btn btn-ghost btn-sm text-base-content/60 hover:text-error gap-2 transition-colors">
                    <i data-lucide="log-out" class="w-4 h-4"></i>
                    <span class="hidden sm:inline">Sair</span>
                </button>
            </form>

            <button
                hx-get="{% url 'create_booking_htmx' %}"
                hx-target="#booking-modal-container"
                hx-swap="innerHTML"
                class="btn btn-primary btn-sm gap-2 rounded-full shadow-lg shadow-primary/30 text-primary-content flex-1 md:flex-none">
                <i data-lucide="plus" class="w-4 h-4"></i> Nova Reserva
            </button>
        </div>
    </div>

    <div class="mb-6">
        <h3 class="font-bold text-base-content/70 mb-3 flex items-center gap-2 text-sm uppercase tracking-wider">
            <i data-lucide="bell-ring" class="w-4 h-4 text-warning"></i> Atenção Operacional
        </h3>

        <div hx-get="{% url 'dashboard_alerts_partial' %}"
             hx-trigger="load"
             hx-swap="innerHTML"
             class="min-h-[80px]">
             
            <div class="animate-pulse space-y-3">
                <div class="h-16 bg-base-100 border border-base-200 rounded-xl w-full flex items-center p-4">
                    <div class="w-8 h-8 bg-base-300 rounded-full mr-4"></div>
                    <div class="flex-1 space-y-2">
                        <div class="h-3 bg-base-300 rounded w-1/4"></div>
                        <div class="h-2 bg-base-300 rounded w-1/2"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <div class="card bg-base-100 shadow-sm border border-base-200 hover:shadow-md transition-all">
            <div class="card-body p-6 flex flex-row items-center justify-between">
                <div>
                    <p class="text-xs font-bold text-base-content/50 uppercase tracking-wider">Ocupação</p>
                    <h3 class="text-2xl font-bold text-base-content mt-1">{{ occupancy_rate }}%</h3>
                    <p class="text-xs text-success mt-1 flex items-center gap-1 font-medium">
                        <i data-lucide="trending-up" class="w-3 h-3"></i> Alta demanda
                    </p>
                </div>
                <div class="w-12 h-12 rounded-2xl bg-blue-50 text-blue-600 flex items-center justify-center">
                    <i data-lucide="pie-chart" class="w-6 h-6"></i>
                </div>
            </div>
        </div>

        <div class="card bg-base-100 shadow-sm border border-base-200 hover:shadow-md transition-all">
            <div class="card-body p-6 flex flex-row items-center justify-between">
                <div>
                    <p class="text-xs font-bold text-base-content/50 uppercase tracking-wider">Check-ins Hoje</p>
                    <h3 class="text-2xl font-bold text-base-content mt-1">{{ check_ins }}</h3>
                    <p class="text-xs text-base-content/60 mt-1">Hóspedes chegando</p>
                </div>
                <div class="w-12 h-12 rounded-2xl bg-emerald-50 text-emerald-600 flex items-center justify-center">
                    <i data-lucide="log-in" class="w-6 h-6"></i>
                </div>
            </div>
        </div>

        <div class="card bg-base-100 shadow-sm border border-base-200 hover:shadow-md transition-all">
            <div class="card-body p-6 flex flex-row items-center justify-between">
                <div>
                    <p class="text-xs font-bold text-base-content/50 uppercase tracking-wider">Check-outs Hoje</p>
                    <h3 class="text-2xl font-bold text-base-content mt-1">{{ check_outs }}</h3>
                    <p class="text-xs text-base-content/60 mt-1">Quartos liberando</p>
                </div>
                <div class="w-12 h-12 rounded-2xl bg-orange-50 text-orange-600 flex items-center justify-center">
                    <i data-lucide="log-out" class="w-6 h-6"></i>
                </div>
            </div>
        </div>

        <div class="card bg-base-100 shadow-sm border border-base-200 hover:shadow-md transition-all">
            <div class="card-body p-6 flex flex-row items-center justify-between">
                <div>
                    <p class="text-xs font-bold text-base-content/50 uppercase tracking-wider">Limpeza</p>
                    <h3 class="text-2xl font-bold text-base-content mt-1">{{ cleaning_rooms }}</h3>
                    <p class="text-xs text-warning mt-1 font-medium">Aguardando ação</p>
                </div>
                <div class="w-12 h-12 rounded-2xl bg-yellow-50 text-yellow-600 flex items-center justify-center">
                    <i data-lucide="sparkles" class="w-6 h-6"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="card bg-base-100 shadow-sm border border-base-200">
        <div class="card-header p-6 border-b border-base-200 flex flex-col sm:flex-row justify-between items-center gap-4">
            <h3 class="font-bold text-lg text-base-content">Mapa de Quartos</h3>

            <div class="flex gap-4 text-xs font-medium bg-base-200/50 p-2 rounded-lg">
                <span class="flex items-center gap-1.5">
                    <span class="w-2.5 h-2.5 rounded-full bg-emerald-500 shadow-sm"></span> Disponível
                </span>
                <span class="flex items-center gap-1.5">
                    <span class="w-2.5 h-2.5 rounded-full bg-rose-500 shadow-sm"></span> Ocupado
                </span>
                <span class="flex items-center gap-1.5">
                    <span class="w-2.5 h-2.5 rounded-full bg-amber-500 shadow-sm"></span> Sujo
                </span>
            </div>
        </div>

        <div class="card-body p-6">
            <div class="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-4">
                {% for room in rooms %}
                <div class="relative group cursor-pointer"
                     hx-get="{% url 'room_details_modal' room.id %}"
                     hx-target="#booking-modal-container"
                     hx-swap="innerHTML">

                    <div class="aspect-square rounded-2xl flex flex-col items-center justify-center transition-all hover:scale-105 hover:shadow-lg shadow-sm border
                        {% if room.status == 'AVAILABLE' %}
                            bg-emerald-50/80 text-emerald-800 border-emerald-200
                        {% elif room.status == 'OCCUPIED' %}
                            bg-rose-50/80 text-rose-800 border-rose-200
                        {% elif room.status == 'DIRTY' %}
                            bg-amber-50/80 text-amber-800 border-amber-200
                        {% else %}
                            bg-base-200 text-base-content/50 border-base-300
                        {% endif %}">

                        <span class="text-2xl font-bold">{{ room.number }}</span>
                        
                        <span class="text-[10px] uppercase font-extrabold tracking-wider mt-1 opacity-80">
                            {{ room.get_status_display }}
                        </span>

                        {% if room.status == 'OCCUPIED' %}
                        <div class="absolute top-2 right-2 p-1 bg-white/50 rounded-full">
                            <i data-lucide="user" class="w-3 h-3 text-rose-600"></i>
                        </div>
                        {% endif %}

                        {% if room.status == 'DIRTY' %}
                        <div class="absolute top-2 right-2 p-1 bg-white/50 rounded-full">
                            <i data-lucide="sparkles" class="w-3 h-3 text-amber-600"></i>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% empty %}
                <div class="col-span-full py-16 flex flex-col items-center text-base-content/40">
                    <i data-lucide="ghost" class="w-12 h-12 mb-2 opacity-20"></i>
                    <p>Nenhum quarto cadastrado.</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<div id="booking-modal-container"></div>

<script>
    document.body.addEventListener('bookingSaved', function(){
        window.location.reload();
    })
</script>
{% endblock %}
