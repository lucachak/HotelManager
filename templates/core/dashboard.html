{% extends 'base.html' %}

{% block title %}Dashboard | Hotel Lux{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto space-y-8">

    <div class="flex justify-between items-end">
        <div>
            <h2 class="text-3xl font-bold text-gray-800">Visão Geral</h2>
            <p class="text-gray-500 mt-1">
                Bem-vindo de volta, aqui está o resumo de hoje ({{ today|date:"d/m/Y" }}).
            </p>
        </div>

        <div class="flex items-center gap-3">
            <form action="{% url 'logout_to_login' %}" method="post" class="inline">
                {% csrf_token %}
                <button type="submit" class="btn btn-ghost btn-sm text-gray-400 hover:text-error gap-2 transition-colors">
                    <i data-lucide="log-out" class="w-4 h-4"></i>
                    <span>Sair</span>
                </button>
            </form>

            <button
                hx-get="{% url 'create_booking_htmx' %}"
                hx-target="#booking-modal-container"
                hx-swap="innerHTML"
                class="btn btn-primary btn-sm gap-2 rounded-full shadow-lg shadow-primary/30 text-white">
                <i data-lucide="plus" class="w-4 h-4"></i> Nova Reserva
            </button>
        </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <div class="card bg-white shadow-sm border border-gray-100 hover:shadow-md transition-all">
            <div class="card-body p-6 flex flex-row items-center justify-between">
                <div>
                    <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider">Ocupação</p>
                    <h3 class="text-2xl font-bold text-gray-800 mt-1">{{ occupancy_rate }}%</h3>
                    <p class="text-xs text-success mt-1 flex items-center gap-1">
                        <i data-lucide="trending-up" class="w-3 h-3"></i> Alta demanda
                    </p>
                </div>
                <div class="w-12 h-12 rounded-full bg-blue-50 flex items-center justify-center text-blue-500">
                    <i data-lucide="pie-chart"></i>
                </div>
            </div>
        </div>

        <div class="card bg-white shadow-sm border border-gray-100 hover:shadow-md transition-all">
            <div class="card-body p-6 flex flex-row items-center justify-between">
                <div>
                    <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider">Check-ins Hoje</p>
                    <h3 class="text-2xl font-bold text-gray-800 mt-1">{{ check_ins }}</h3>
                    <p class="text-xs text-gray-400 mt-1">Hóspedes chegando</p>
                </div>
                <div class="w-12 h-12 rounded-full bg-emerald-50 flex items-center justify-center text-emerald-500">
                    <i data-lucide="log-in"></i>
                </div>
            </div>
        </div>

        <div class="card bg-white shadow-sm border border-gray-100 hover:shadow-md transition-all">
            <div class="card-body p-6 flex flex-row items-center justify-between">
                <div>
                    <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider">Check-outs Hoje</p>
                    <h3 class="text-2xl font-bold text-gray-800 mt-1">{{ check_outs }}</h3>
                    <p class="text-xs text-gray-400 mt-1">Quartos liberando</p>
                </div>
                <div class="w-12 h-12 rounded-full bg-orange-50 flex items-center justify-center text-orange-500">
                    <i data-lucide="log-out"></i>
                </div>
            </div>
        </div>

        <div class="card bg-white shadow-sm border border-gray-100 hover:shadow-md transition-all">
            <div class="card-body p-6 flex flex-row items-center justify-between">
                <div>
                    <p class="text-xs font-semibold text-gray-400 uppercase tracking-wider">Limpeza</p>
                    <h3 class="text-2xl font-bold text-gray-800 mt-1">{{ cleaning_rooms }}</h3>
                    <p class="text-xs text-warning mt-1">Aguardando ação</p>
                </div>
                <div class="w-12 h-12 rounded-full bg-yellow-50 flex items-center justify-center text-yellow-500">
                    <i data-lucide="sparkles"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="card bg-white shadow-sm border border-gray-100">
        <div class="card-header p-6 border-b border-gray-50 flex justify-between items-center">
            <h3 class="font-bold text-lg text-gray-800">Mapa de Quartos</h3>

            <div class="flex gap-4 text-xs">
                <span class="flex items-center gap-1">
                    <span class="w-2 h-2 rounded-full bg-emerald-400"></span> Disponível
                </span>
                <span class="flex items-center gap-1">
                    <span class="w-2 h-2 rounded-full bg-rose-400"></span> Ocupado
                </span>
                <span class="flex items-center gap-1">
                    <span class="w-2 h-2 rounded-full bg-amber-400"></span> Sujo
                </span>
            </div>
        </div>

        <div class="card-body p-6">
            <div class="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-4">
                {% for room in rooms %}
                <div class="relative group cursor-pointer"
                     hx-get="{% url 'room_details_modal' room.id %}"
                     hx-target="#booking-modal-container"
                     hx-swap="innerHTML">

                    <div class="aspect-square rounded-2xl flex flex-col items-center justify-center transition-all hover:scale-105 shadow-sm border
                        {% if room.status == 'AVAILABLE' %}
                            bg-emerald-50 text-emerald-700 border-emerald-100
                        {% elif room.status == 'OCCUPIED' %}
                            bg-rose-50 text-rose-700 border-rose-100
                        {% elif room.status == 'DIRTY' %}
                            bg-amber-50 text-amber-700 border-amber-100
                        {% else %}
                            bg-gray-100 text-gray-500 border-gray-200
                        {% endif %}">

                        <span class="text-2xl font-bold">{{ room.number }}</span>
                        <span class="text-[10px] uppercase font-bold tracking-wider mt-1">
                            {{ room.get_status_display }}
                        </span>

                        {% if room.status == 'OCCUPIED' %}
                        <div class="absolute top-2 right-2">
                            <i data-lucide="user" class="w-3 h-3 opacity-50"></i>
                        </div>
                        {% endif %}

                        {% if room.status == 'DIRTY' %}
                        <div class="absolute top-2 right-2">
                            <i data-lucide="sparkles" class="w-3 h-3 opacity-50"></i>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% empty %}
                <p class="col-span-full text-center text-gray-400 py-10"> Nenhum quarto cadastrado. </p>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
<div id="booking-modal-container"></div>

<script>
    document.body.addEventListener('bookingSaved', function(){
        window.location.reload();
    })
</script>
{% endblock %}
