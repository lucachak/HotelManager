<div id="room-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 animate-fade-in">
    <div class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity" onclick="document.getElementById('room-modal').remove()"></div>

    <div class="bg-base-100 rounded-2xl shadow-2xl w-full max-w-lg relative z-10 overflow-hidden flex flex-col max-h-[90vh]">

        <div class="bg-emerald-600 p-4 text-white flex justify-between items-center">
            <h3 class="font-bold text-lg flex items-center gap-2">
                <i data-lucide="banknote" class="w-5 h-5"></i> Receber Pagamento
            </h3>
            <button onclick="document.getElementById('room-modal').remove()" class="btn btn-ghost btn-circle btn-sm text-white hover:bg-white/20">✕</button>
        </div>

        <form hx-post="{% url 'receive_payment_htmx' booking.id %}"
              hx-target="#booking-modal-container"
              hx-swap="innerHTML"
              class="flex flex-col flex-1 overflow-hidden">

            <div class="p-6 space-y-4 overflow-y-auto flex-1">
                <div class="stats shadow-sm w-full bg-emerald-50 border border-emerald-100">
                    <div class="stat p-4 text-center">
                        <div class="stat-title text-emerald-700 text-xs uppercase font-bold tracking-wider">Falta Pagar</div>
                        <div class="stat-value text-emerald-700 text-3xl">R$ {{ booking.balance_due }}</div>
                    </div>
                </div>

                {% if error %}
                <div class="alert alert-error text-white text-sm shadow-md animate-pulse">
                    <i data-lucide="alert-triangle" class="w-5 h-5"></i>
                    <span>{{ error }}</span>
                </div>
                {% endif %}

                <div class="form-control">
                    <label class="label font-bold text-gray-700">Valor a Receber</label>
                    <label class="input input-bordered flex items-center gap-2">
                        R$ <input type="number" name="amount" value="{{ form.amount.value|default:'' }}" step="0.01" class="grow font-bold text-lg" required />
                    </label>
                    {% if form.amount.errors %}
                        <span class="text-error text-xs mt-1">{{ form.amount.errors.0 }}</span>
                    {% endif %}
                </div>

                <div class="form-control">
                    <label class="label font-bold text-gray-700">Forma de Pagamento</label>
                    {{ form.payment_method }}
                </div>

                <div class="form-control">
                    <label class="label font-bold text-gray-700">Observação</label>
                    {{ form.description }}
                </div>
            </div>

            <div class="p-4 bg-gray-50 border-t flex justify-end gap-2">
                {% with room=booking.allocations.first.room %}
                <button
                    type="button"
                    hx-get="{% url 'room_details_modal' room.id %}"
                    hx-target="#booking-modal-container"
                    hx-swap="innerHTML"
                    class="btn btn-ghost">
                    Voltar
                </button>
                {% endwith %}

                <button type="submit" class="btn btn-success text-white shadow-lg shadow-emerald-500/30">
                    Confirmar Recebimento
                </button>
            </div>
        </form>
    </div>
</div>
<script>if (typeof lucide !== 'undefined') lucide.createIcons();</script>
